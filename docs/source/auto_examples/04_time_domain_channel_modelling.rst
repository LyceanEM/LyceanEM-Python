
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples\04_time_domain_channel_modelling.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_04_time_domain_channel_modelling.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_04_time_domain_channel_modelling.py:


Modelling a Physical Channel in the Time Domain
======================================================

This example uses the frequency domain :func:`lyceanem.models.time_domain.calculate_scattering` function to
predict the time domain response for a given excitation signal and environment included in the model.
This model allows for a very wide range of antennas and antenna arrays to be considered, but for simplicity only horn
antennas will be included in this example. The simplest case would be a single source point and single receive point,
rather than an aperture antenna such as a horn.

.. GENERATED FROM PYTHON SOURCE LINES 14-17

.. code-block:: Python


    import numpy as np








.. GENERATED FROM PYTHON SOURCE LINES 18-21

Frequency and Mesh Resolution
------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 21-36

.. code-block:: Python

    sampling_freq = 23e9
    model_time = 1e-7
    num_samples = int(model_time * (sampling_freq))

    # simulate receiver noise
    bandwidth = 8e9
    kb = 1.38065e-23
    receiver_impedence = 50
    thermal_noise_power = 4 * kb * 293.15 * receiver_impedence * bandwidth
    noise_power = -80  # dbw
    mean_noise = 0

    model_freq = 10e9
    wavelength = 3e8 / model_freq








.. GENERATED FROM PYTHON SOURCE LINES 37-40

Setup transmitters and receivers
-----------------------------------


.. GENERATED FROM PYTHON SOURCE LINES 40-50

.. code-block:: Python

    import lyceanem.geometry.targets as TL
    import lyceanem.geometry.geometryfunctions as GF

    transmit_horn_structure, transmitting_antenna_surface_coords = TL.meshedHorn(
        58e-3, 58e-3, 128e-3, 2e-3, 0.21, wavelength * 0.5
    )
    receive_horn_structure, receiving_antenna_surface_coords = TL.meshedHorn(
        58e-3, 58e-3, 128e-3, 2e-3, 0.21, wavelength * 0.5
    )








.. GENERATED FROM PYTHON SOURCE LINES 51-56

Position Transmitter
----------------------
rotate the transmitting antenna to the desired orientation, and then translate to final position.
:func:`lyceanem.geometry.geometryfunctions.translate_mesh`, :func:`lyceanem.geometry.geometryfunctions.mesh_rotate` and :func:`lyceanem.geometry.geometryfunctions.mesh_transform` are included, allowing translation, rotation, and transformation of the meshio objects as required.


.. GENERATED FROM PYTHON SOURCE LINES 56-74

.. code-block:: Python

    rotation_vector1 = np.radians(np.asarray([90.0, 0.0, 0.0]))
    rotation_vector2 = np.radians(np.asarray([0.0, 0.0, -90.0]))


    transmit_horn_structure = GF.mesh_rotate(transmit_horn_structure, rotation_vector1)
    transmit_horn_structure = GF.mesh_rotate(transmit_horn_structure, rotation_vector2)
    transmit_horn_structure = GF.mesh_translate(
        transmit_horn_structure, np.asarray([2.695, 0, 0])
    )
    transmitting_antenna_surface_coords = GF.mesh_rotate(
        transmitting_antenna_surface_coords, rotation_vector1
    )
    transmitting_antenna_surface_coords = GF.mesh_rotate(
        transmitting_antenna_surface_coords, rotation_vector2
    )
    transmitting_antenna_surface_coords = GF.mesh_translate(
        transmitting_antenna_surface_coords, np.asarray([2.695, 0, 0])
    )







.. GENERATED FROM PYTHON SOURCE LINES 75-78

Position Receiver
------------------
rotate the receiving horn to desired orientation and translate to final position.

.. GENERATED FROM PYTHON SOURCE LINES 78-91

.. code-block:: Python



    receive_horn_structure = GF.mesh_rotate(receive_horn_structure, rotation_vector1)
    receive_horn_structure = GF.mesh_translate(
        receive_horn_structure, np.asarray([0, 1.427, 0])
    )
    receiving_antenna_surface_coords = GF.mesh_rotate(
        receiving_antenna_surface_coords, rotation_vector1
    )
    receiving_antenna_surface_coords = GF.mesh_translate(
        receiving_antenna_surface_coords, np.asarray([0, 1.427, 0])
    )








.. GENERATED FROM PYTHON SOURCE LINES 92-95

Create Scattering Plate
--------------------------
Create a Scattering plate a source of multipath reflections

.. GENERATED FROM PYTHON SOURCE LINES 95-107

.. code-block:: Python


    reflectorplate, scatter_points = TL.meshedReflector(
        0.3, 0.3, 6e-3, wavelength * 0.5, sides="front"
    )
    position_vector = np.asarray([29e-3, 0.0, 0])
    rotation_vector1 = np.radians(np.asarray([0.0, 90.0, 0.0]))
    scatter_points = GF.mesh_rotate(scatter_points, rotation_vector1)
    reflectorplate = GF.mesh_rotate(reflectorplate, rotation_vector1)
    reflectorplate = GF.mesh_translate(reflectorplate, position_vector)
    scatter_points = GF.mesh_translate(scatter_points, position_vector)






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    meshing reflector
    args 0.3 0.3 0.006
    majorsize 0.3
    minorsize 0.3
    thickness 0.006




.. GENERATED FROM PYTHON SOURCE LINES 108-111

Specify Reflection Angle
--------------------------
Rotate the scattering plate to the optimum angle for reflection from the transmitting to receiving horn

.. GENERATED FROM PYTHON SOURCE LINES 111-122

.. code-block:: Python


    plate_orientation_angle = 45.0

    rotation_vector = np.radians(np.asarray([0.0, 0.0, plate_orientation_angle]))
    scatter_points = GF.mesh_rotate(scatter_points, rotation_vector)
    reflectorplate = GF.mesh_rotate(reflectorplate, rotation_vector)
    from lyceanem.base_classes import structures

    blockers = structures([reflectorplate, receive_horn_structure, transmit_horn_structure])









.. GENERATED FROM PYTHON SOURCE LINES 123-125

Visualise the Scene Geometry
------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 125-137

.. code-block:: Python


    import pyvista as pv


    ## plot the mesh
    plotter = pv.Plotter()
    plotter.add_mesh(pv.from_meshio(reflectorplate), color="white", show_edges=True)
    plotter.add_mesh(pv.from_meshio(receive_horn_structure), color="blue", show_edges=True)
    plotter.add_mesh(pv.from_meshio(transmit_horn_structure), color="red", show_edges=True)
    plotter.add_axes_at_origin()
    plotter.show()








.. tab-set::



   .. tab-item:: Static Scene



            
     .. image-sg:: /auto_examples/images/sphx_glr_04_time_domain_channel_modelling_001.png
        :alt: 04 time domain channel modelling
        :srcset: /auto_examples/images/sphx_glr_04_time_domain_channel_modelling_001.png
        :class: sphx-glr-single-img
     


   .. tab-item:: Interactive Scene



       .. offlineviewer:: C:\Users\lycea\PycharmProjects\LyceanEM-Python\docs\source\auto_examples\images\sphx_glr_04_time_domain_channel_modelling_001.vtksz






.. GENERATED FROM PYTHON SOURCE LINES 138-141

Specify desired Transmit Polarisation
--------------------------------------
The transmit polarisation has a significant effect on the channel characteristics. In this example the transmit horn will be vertically polarised, (e-vector aligned with the z direction)

.. GENERATED FROM PYTHON SOURCE LINES 141-145

.. code-block:: Python


    desired_E_axis = np.zeros((1, 3), dtype=np.float32)
    desired_E_axis[0, 1] = 1.0








.. GENERATED FROM PYTHON SOURCE LINES 146-149

Time Domain Scattering
----------------------------


.. GENERATED FROM PYTHON SOURCE LINES 149-228

.. code-block:: Python

    import scipy.signal as sig
    import lyceanem.models.time_domain as TD
    from lyceanem.base_classes import structures


    angle_values = np.linspace(0, 90, 91)
    angle_increment = np.diff(angle_values)[0]
    responsex = np.zeros((len(angle_values)), dtype="complex")
    responsey = np.zeros((len(angle_values)), dtype="complex")
    responsez = np.zeros((len(angle_values)), dtype="complex")

    plate_orientation_angle = -45.0

    rotation_vector = np.radians(
        np.asarray([0.0, 0.0, plate_orientation_angle + angle_increment])
    )
    scatter_points = GF.mesh_rotate(scatter_points, rotation_vector)
    reflectorplate = GF.mesh_rotate(reflectorplate, rotation_vector)

    from tqdm import tqdm

    wake_times = np.zeros((len(angle_values)))
    Ex = np.zeros((len(angle_values), num_samples))
    Ey = np.zeros((len(angle_values), num_samples))
    Ez = np.zeros((len(angle_values), num_samples))

    for angle_inc in tqdm(range(len(angle_values))):
        rotation_vector = np.radians(np.asarray([0.0, 0.0, angle_increment]))
        scatter_points = GF.mesh_rotate(scatter_points, rotation_vector)
        reflectorplate = GF.mesh_rotate(reflectorplate, rotation_vector)
        blockers = structures(
            [reflectorplate, transmit_horn_structure, receive_horn_structure]
        )
        pulse_time = 5e-9
        output_power = 0.01  # dBwatts
        powerdbm = 10 * np.log10(output_power) + 30
        v_transmit = ((10 ** (powerdbm / 20)) * receiver_impedence) ** 0.5
        output_amplitude_rms = v_transmit / (1 / np.sqrt(2))
        output_amplitude_peak = v_transmit

        desired_E_axis = np.zeros((1, 3), dtype=np.float32)
        desired_E_axis[0, 1] = 1.0
        noise_volts_peak = (10 ** (noise_power / 10) * receiver_impedence) * 0.5

        excitation_signal = output_amplitude_rms * sig.chirp(
            np.linspace(0, pulse_time, int(pulse_time * sampling_freq)),
            model_freq - bandwidth,
            pulse_time,
            model_freq,
            method="linear",
            phi=0,
            vertex_zero=True,
        ) + np.random.normal(mean_noise, noise_volts_peak, int(pulse_time * sampling_freq))
        (
            Ex[angle_inc, :],
            Ey[angle_inc, :],
            Ez[angle_inc, :],
            wake_times[angle_inc],
        ) = TD.calculate_scattering(
            transmitting_antenna_surface_coords,
            receiving_antenna_surface_coords,
            excitation_signal,
            blockers,
            desired_E_axis,
            scatter_points=scatter_points,
            wavelength=wavelength,
            scattering=1,
            elements=False,
            sampling_freq=sampling_freq,
            num_samples=num_samples,
            beta=(2 * np.pi) / wavelength,
        )

        noise_volts = np.random.normal(mean_noise, noise_volts_peak, num_samples)
        Ex[angle_inc, :] = Ex[angle_inc, :] + noise_volts
        Ey[angle_inc, :] = Ey[angle_inc, :] + noise_volts
        Ez[angle_inc, :] = Ez[angle_inc, :] + noise_volts






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

      0%|                                                                                                                                                                                                       | 0/91 [00:00<?, ?it/s]C:\Users\lycea\miniconda3\envs\CudaDevelopment\Lib\site-packages\lyceanem\electromagnetics\empropagation.py:3719: ComplexWarning: Casting complex values to real discards the imaginary part
      uvn_axes[2, :] = point_vector
    C:\Users\lycea\miniconda3\envs\CudaDevelopment\Lib\site-packages\lyceanem\electromagnetics\empropagation.py:3736: ComplexWarning: Casting complex values to real discards the imaginary part
      uvn_axes[0, :] = np.cross(local_axes[2, :], point_vector) / np.linalg.norm(
    C:\Users\lycea\miniconda3\envs\CudaDevelopment\Lib\site-packages\lyceanem\electromagnetics\empropagation.py:3758: ComplexWarning: Casting complex values to real discards the imaginary part
      uvn_axes[1, :] = np.cross(point_vector, uvn_axes[0, :]) / np.linalg.norm(
    C:\Users\lycea\miniconda3\envs\CudaDevelopment\Lib\site-packages\numba\cuda\dispatcher.py:536: NumbaPerformanceWarning: Grid size 25 will likely result in GPU under-utilization due to low occupancy.
      warn(NumbaPerformanceWarning(msg))
      1%|██                                                                                                                                                                                             | 1/91 [00:04<07:11,  4.79s/it]C:\Users\lycea\miniconda3\envs\CudaDevelopment\Lib\site-packages\lyceanem\electromagnetics\empropagation.py:3719: ComplexWarning: Casting complex values to real discards the imaginary part
      uvn_axes[2, :] = point_vector
    C:\Users\lycea\miniconda3\envs\CudaDevelopment\Lib\site-packages\lyceanem\electromagnetics\empropagation.py:3736: ComplexWarning: Casting complex values to real discards the imaginary part
      uvn_axes[0, :] = np.cross(local_axes[2, :], point_vector) / np.linalg.norm(
    C:\Users\lycea\miniconda3\envs\CudaDevelopment\Lib\site-packages\lyceanem\electromagnetics\empropagation.py:3758: ComplexWarning: Casting complex values to real discards the imaginary part
      uvn_axes[1, :] = np.cross(point_vector, uvn_axes[0, :]) / np.linalg.norm(
      2%|████▏                                                                                                                                                                                          | 2/91 [00:05<03:11,  2.15s/it]      4%|████████▍                                                                                                                                                                                      | 4/91 [00:05<01:14,  1.17it/s]      7%|████████████▌                                                                                                                                                                                  | 6/91 [00:05<00:42,  2.02it/s]      9%|████████████████▊                                                                                                                                                                              | 8/91 [00:05<00:27,  3.02it/s]     11%|████████████████████▉                                                                                                                                                                         | 10/91 [00:05<00:19,  4.11it/s]     13%|█████████████████████████                                                                                                                                                                     | 12/91 [00:05<00:15,  5.25it/s]     15%|█████████████████████████████▏                                                                                                                                                                | 14/91 [00:06<00:12,  6.36it/s]     18%|█████████████████████████████████▍                                                                                                                                                            | 16/91 [00:06<00:10,  7.40it/s]     20%|█████████████████████████████████████▌                                                                                                                                                        | 18/91 [00:06<00:08,  8.34it/s]     22%|█████████████████████████████████████████▊                                                                                                                                                    | 20/91 [00:06<00:07,  9.06it/s]     24%|█████████████████████████████████████████████▉                                                                                                                                                | 22/91 [00:06<00:07,  9.60it/s]     26%|██████████████████████████████████████████████████                                                                                                                                            | 24/91 [00:07<00:06,  9.76it/s]     29%|██████████████████████████████████████████████████████▎                                                                                                                                       | 26/91 [00:07<00:06,  9.84it/s]     31%|██████████████████████████████████████████████████████████▍                                                                                                                                   | 28/91 [00:07<00:06,  9.94it/s]     33%|██████████████████████████████████████████████████████████████▋                                                                                                                               | 30/91 [00:07<00:06,  9.97it/s]     35%|██████████████████████████████████████████████████████████████████▊                                                                                                                           | 32/91 [00:07<00:05,  9.90it/s]     37%|██████████████████████████████████████████████████████████████████████▉                                                                                                                       | 34/91 [00:08<00:05,  9.71it/s]     38%|█████████████████████████████████████████████████████████████████████████                                                                                                                     | 35/91 [00:08<00:05,  9.76it/s]     40%|███████████████████████████████████████████████████████████████████████████▏                                                                                                                  | 36/91 [00:08<00:05,  9.77it/s]     41%|█████████████████████████████████████████████████████████████████████████████▎                                                                                                                | 37/91 [00:08<00:05,  9.78it/s]     42%|███████████████████████████████████████████████████████████████████████████████▎                                                                                                              | 38/91 [00:08<00:05,  9.77it/s]     43%|█████████████████████████████████████████████████████████████████████████████████▍                                                                                                            | 39/91 [00:08<00:05,  9.77it/s]     44%|███████████████████████████████████████████████████████████████████████████████████▌                                                                                                          | 40/91 [00:08<00:05,  9.79it/s]     45%|█████████████████████████████████████████████████████████████████████████████████████▌                                                                                                        | 41/91 [00:08<00:05,  9.73it/s]     46%|███████████████████████████████████████████████████████████████████████████████████████▋                                                                                                      | 42/91 [00:08<00:05,  9.74it/s]     47%|█████████████████████████████████████████████████████████████████████████████████████████▊                                                                                                    | 43/91 [00:09<00:05,  9.42it/s]     48%|███████████████████████████████████████████████████████████████████████████████████████████▊                                                                                                  | 44/91 [00:09<00:05,  9.36it/s]     49%|█████████████████████████████████████████████████████████████████████████████████████████████▉                                                                                                | 45/91 [00:09<00:04,  9.53it/s]     51%|████████████████████████████████████████████████████████████████████████████████████████████████                                                                                              | 46/91 [00:09<00:04,  9.65it/s]     53%|████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                                         | 48/91 [00:09<00:04,  9.81it/s]     54%|██████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                                       | 49/91 [00:09<00:04,  9.70it/s]     56%|██████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                                                   | 51/91 [00:09<00:04,  9.90it/s]     57%|████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                                                 | 52/91 [00:09<00:03,  9.89it/s]     58%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                               | 53/91 [00:10<00:03,  9.86it/s]     59%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                                             | 54/91 [00:10<00:03,  9.83it/s]     62%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                                         | 56/91 [00:10<00:03,  9.92it/s]     64%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                                                     | 58/91 [00:10<00:03,  9.99it/s]     65%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                                                  | 59/91 [00:10<00:03,  9.98it/s]     66%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                                | 60/91 [00:10<00:03,  9.90it/s]     67%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                                                              | 61/91 [00:10<00:03,  9.87it/s]     68%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                                            | 62/91 [00:10<00:02,  9.86it/s]     69%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                                          | 63/91 [00:11<00:02,  9.53it/s]     70%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                        | 64/91 [00:11<00:02,  9.46it/s]     71%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋                                                      | 65/91 [00:11<00:02,  9.17it/s]     73%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                                                    | 66/91 [00:11<00:02,  8.95it/s]     74%|███████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                                                  | 67/91 [00:11<00:02,  8.84it/s]     76%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                              | 69/91 [00:11<00:02,  9.45it/s]     78%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▏                                         | 71/91 [00:11<00:02,  9.74it/s]     80%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍                                     | 73/91 [00:12<00:01,  9.99it/s]     82%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▌                                 | 75/91 [00:12<00:01, 10.17it/s]     85%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊                             | 77/91 [00:12<00:01, 10.15it/s]     87%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▉                         | 79/91 [00:12<00:01, 10.25it/s]     89%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                     | 81/91 [00:12<00:00, 10.23it/s]     91%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▎                | 83/91 [00:13<00:00, 10.24it/s]     93%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▍            | 85/91 [00:13<00:00, 10.26it/s]     96%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▋        | 87/91 [00:13<00:00,  9.84it/s]C:\Users\lycea\miniconda3\envs\CudaDevelopment\Lib\site-packages\numba\cuda\dispatcher.py:536: NumbaPerformanceWarning: Grid size 115 will likely result in GPU under-utilization due to low occupancy.
      warn(NumbaPerformanceWarning(msg))
     98%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████▊    | 89/91 [00:13<00:00, 10.98it/s]C:\Users\lycea\miniconda3\envs\CudaDevelopment\Lib\site-packages\numba\cuda\dispatcher.py:536: NumbaPerformanceWarning: Grid size 20 will likely result in GPU under-utilization due to low occupancy.
      warn(NumbaPerformanceWarning(msg))
    100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 91/91 [00:13<00:00,  6.65it/s]




.. GENERATED FROM PYTHON SOURCE LINES 229-232

Plot Normalised Response
----------------------------
Using matplotlib, plot the results

.. GENERATED FROM PYTHON SOURCE LINES 232-292

.. code-block:: Python



    import matplotlib.pyplot as plt

    time_index = np.linspace(0, model_time * 1e9, num_samples)
    time, anglegrid = np.meshgrid(time_index[:1801], angle_values - 45)
    norm_max = np.nanmax(
        np.array(
            [
                np.nanmax(10 * np.log10((Ex**2) / receiver_impedence)),
                np.nanmax(10 * np.log10((Ey**2) / receiver_impedence)),
                np.nanmax(10 * np.log10((Ez**2) / receiver_impedence)),
            ]
        )
    )

    fig2, ax2 = plt.subplots(constrained_layout=True)
    origin = "lower"
    # Now make a contour plot with the levels specified,
    # and with the colormap generated automatically from a list
    # of colors.

    levels = np.linspace(-80, 0, 41)

    CS = ax2.contourf(
        anglegrid,
        time,
        10 * np.log10((Ez[:, :1801] ** 2) / receiver_impedence) - norm_max,
        levels,
        origin=origin,
        extend="both",
    )
    cbar = fig2.colorbar(CS)
    cbar.ax.set_ylabel("Received Power (dBm)")

    ax2.set_ylim(0, 30)
    ax2.set_xlim(-45, 45)

    ax2.set_xticks(np.linspace(-45, 45, 7))
    ax2.set_yticks(np.linspace(0, 30, 16))

    ax2.set_xlabel("Rotation Angle (degrees)")
    ax2.set_ylabel("Time of Flight (ns)")
    ax2.set_title("Received Power vs Time for rotating Plate (24GHz)")

    from scipy.fft import fft, fftfreq
    import scipy

    xf = fftfreq(len(time_index), 1 / sampling_freq)[: len(time_index) // 2]
    frequency_index = np.where(xf == model_freq)
    input_signal = excitation_signal * (output_amplitude_peak)
    inputfft = fft(input_signal)
    input_freq = fftfreq(120, 1 / sampling_freq)[:60]
    freqfuncabs = scipy.interpolate.interp1d(input_freq, np.abs(inputfft[:60]))
    freqfuncangle = scipy.interpolate.interp1d(input_freq, np.angle(inputfft[:60]))
    newinput = freqfuncabs(xf[frequency_index]) * np.exp(freqfuncangle(xf[frequency_index]))
    Exf = fft(Ex)
    Eyf = fft(Ey)
    Ezf = fft(Ez)




.. image-sg:: /auto_examples/images/sphx_glr_04_time_domain_channel_modelling_002.png
   :alt: Received Power vs Time for rotating Plate (24GHz)
   :srcset: /auto_examples/images/sphx_glr_04_time_domain_channel_modelling_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 293-298

Frequency Specific Results
-------------------------------
The time of flight plot is useful to displaying the output of the model, giving a understanding about what is
physically happening in the channel, but to get an idea of the behaviour in the frequency domain we need to use a
fourier transform to move from time and voltages to frequency.

.. GENERATED FROM PYTHON SOURCE LINES 298-317

.. code-block:: Python


    s21x = 20 * np.log10(np.abs(Exf[:, frequency_index] / newinput)).ravel()
    s21y = 20 * np.log10(np.abs(Eyf[:, frequency_index] / newinput)).ravel()
    s21z = 20 * np.log10(np.abs(Ezf[:, frequency_index] / newinput)).ravel()
    tdangles = np.linspace(-45, 45, 91)
    fig, ax = plt.subplots()
    ax.plot(tdangles, s21x - np.max(s21z), label="Ex")
    ax.plot(tdangles, s21y - np.max(s21z), label="Ey")
    ax.plot(tdangles, s21z - np.max(s21z), label="Ez")
    plt.xlabel("$\\theta_{N}$ (degrees)")
    plt.ylabel("Normalised Level (dB)")
    ax.set_ylim(-60.0, 0)
    ax.set_xlim(np.min(angle_values) - 45, np.max(angle_values) - 45)
    ax.set_xticks(np.linspace(np.min(angle_values) - 45, np.max(angle_values) - 45, 19))
    ax.set_yticks(np.linspace(-60, 0.0, 21))
    legend = ax.legend(loc="upper right", shadow=True)
    plt.grid()
    plt.title("$S_{21}$ at 16GHz")
    plt.show()



.. image-sg:: /auto_examples/images/sphx_glr_04_time_domain_channel_modelling_003.png
   :alt: $S_{21}$ at 16GHz
   :srcset: /auto_examples/images/sphx_glr_04_time_domain_channel_modelling_003.png
   :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 14.384 seconds)


.. _sphx_glr_download_auto_examples_04_time_domain_channel_modelling.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: 04_time_domain_channel_modelling.ipynb <04_time_domain_channel_modelling.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: 04_time_domain_channel_modelling.py <04_time_domain_channel_modelling.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: 04_time_domain_channel_modelling.zip <04_time_domain_channel_modelling.zip>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
